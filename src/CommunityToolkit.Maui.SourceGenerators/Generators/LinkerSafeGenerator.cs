using System.Text;
using Microsoft.CodeAnalysis;
using Microsoft.CodeAnalysis.Text;

namespace CommunityToolkit.Maui.SourceGenerators;

[Generator]
class LinkerSafeClassGenerator : IIncrementalGenerator
{
	const string linkerSafeClass = """
// <auto-generated>
// See: CommunityToolkit.Maui.SourceGenerators.LinkerSafeClassGenerator

#nullable enable

using System.ComponentModel;

namespace CommunityToolkit.Maui;

/// <summary> 
/// This class ensures that the Linker does not remove the .NET MAUI Community Toolkit when only its XAML controls are referenced in a library
/// </summary>
[EditorBrowsable(EditorBrowsableState.Never)]
static class LinkerSafeClass
{
	/// <summary> 
	/// This do-nothing method ensures that the Linker does not remove the .NET MAUI Community Toolkit when only its XAML controls are referenced in a library
	/// </summary>
	[EditorBrowsable(EditorBrowsableState.Never)]
	public static void LinkerSafeMethod()
	{
		var temp = DateTime.Now;
	}
}
""";

	public void Initialize(IncrementalGeneratorInitializationContext context)
	{
		context.RegisterPostInitializationOutput(ctx => ctx.AddSource(
			"LinkerSafeClass.g.cs",
			SourceText.From(linkerSafeClass, Encoding.UTF8)));
	}
}

